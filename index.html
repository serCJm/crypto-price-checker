<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="author" content="CJ" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta http-equiv="pragma" content="no-cache" />
    <link rel="stylesheet" href="assets/normalize.css" />
    <link rel="stylesheet" href="assets/styles.min.css" class="css" />
    <script
      defer
      src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"
    ></script>
    <title>Cryptocurrency Price Checker</title>
  </head>

  <body>
    <main class="bg-main not-supported">
      <h4 class="logo">CryptoLogo</h4>
      <h1 class="heading">Check Your Favorite Crypto Price</h1>
      <div class="lookup">
        <input
          class="input-text"
          type="text"
          placeholder="Desired Crypto Name or Ticker"
        /><!-- Remove white space
            --><button id="getPrice">
          <i class="fas fa-space-shuttle"></i>
        </button>
        <div id="dropdown-content"></div>
      </div>

      <div class="price"></div>
      <a
        class="photo-credit"
        style='background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", Helvetica, Ubuntu, Roboto, Noto, "Segoe UI", Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px;'
        href="https://unsplash.com/@oldskool2016?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge"
        target="_blank"
        rel="noopener noreferrer"
        title="Download free do whatever you want high-resolution photos from paul morris"
      >
        <span style="display:inline-block;padding:2px 3px;">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            style="height:12px;width:auto;position:relative;vertical-align:middle;top:-1px;fill:white;"
            viewBox="0 0 32 32"
          >
            <title>unsplash-logo</title>
            <path
              d="M20.8 18.1c0 2.7-2.2 4.8-4.8 4.8s-4.8-2.1-4.8-4.8c0-2.7 2.2-4.8 4.8-4.8 2.7.1 4.8 2.2 4.8 4.8zm11.2-7.4v14.9c0 2.3-1.9 4.3-4.3 4.3h-23.4c-2.4 0-4.3-1.9-4.3-4.3v-15c0-2.3 1.9-4.3 4.3-4.3h3.7l.8-2.3c.4-1.1 1.7-2 2.9-2h8.6c1.2 0 2.5.9 2.9 2l.8 2.4h3.7c2.4 0 4.3 1.9 4.3 4.3zm-8.6 7.5c0-4.1-3.3-7.5-7.5-7.5-4.1 0-7.5 3.4-7.5 7.5s3.3 7.5 7.5 7.5c4.2-.1 7.5-3.4 7.5-7.5z"
            ></path>
          </svg>
        </span>
        <span style="display:inline-block;padding:2px 3px;">paul morris</span>
      </a>
    </main>
  </body>
  <script>
    // fallback check for jpeg image format if JS is not supported in browser.
    document.querySelector(".bg-main").classList.remove("not-supported");
  </script>
  <script src="assets/modernizr-custom.js"></script>
  <script>
   "use strict";window.onload=function(){(function clearInput(){document.getElementsByClassName("input-text")[0].value=""})();function makeRequest(url,cb){var xhr=new XMLHttpRequest();if(!xhr){console.log("Can't create XMLHttp Instance");return!1}
xhr.open("GET",url,!0);xhr.onload=function(){requestContents.call(xhr,cb)};xhr.onerror=function(){console.log("Connection Error")};xhr.send()}
function requestContents(cb){try{if(this.status===200){var response=JSON.parse(this.responseText);return cb(response)}else{console.log("Connected to a server but returned an error. Status: "+this.status+". Text: "+this.statusText)}}catch(e){alert("Exception:"+e.description)}}
var searchField=document.getElementsByClassName("input-text")[0];(function searchBox(){var matchingCoins={};searchField.addEventListener("input",function(){console.log("Start event on input field");if(this.value.length===1){lookupAPI()}else if(this.value.length===0){matchingCoins={};document.getElementById("dropdown-content").innerHTML=""}else{if(Object.keys(matchingCoins).length>0){document.getElementById("dropdown-content").innerHTML="";displayMatches(matchingCoins)}}});function lookupAPI(){makeRequest("https://min-api.cryptocompare.com/data/all/coinlist",function(data){console.log("Start API request");var coins=data.Data;var match=new RegExp("^"+searchField.value,"i");Object.keys(coins).forEach(function(key){if(match.test(coins[key].CoinName)===!0||match.test(coins[key].Symbol)){if(coins[key].IsTrading===!0&&coins[key].SortOrder<=100){matchingCoins[key]=coins[key].CoinName}}});if(searchField.value){displayMatches(matchingCoins)}})}
function displayMatches(obj){console.log("Display suggestions");var dropdown=document.getElementById("dropdown-content");dropdown.innerHTML="";var temp='<ul class="suggestions-list">';var match=new RegExp("^"+searchField.value,"i");Object.keys(obj).forEach(function(key){if(match.test(key)===!0||match.test(obj[key])){temp+='<li class="suggested-coin">'+obj[key]+"</li>"}});temp+="</ul>";dropdown.innerHTML=temp;var suggestions=document.querySelectorAll(".suggested-coin");if(suggestions.length>0){searchField.current=suggestions[0];searchField.current.classList.toggle("suggested-coin-actv");searchField.onkeypress=function(k){console.log(k.keyCode);if(k.keyCode===40){if(!this.current.nextElementSibling){highlight.call(this.current);this.current=suggestions[0];highlight.call(this.current)}else{highlight.call(this.current);this.current=this.current.nextElementSibling;highlight.call(this.current)}}
if(k.keyCode===38){if(!this.current.previousElementSibling){highlight.call(this.current);this.current=suggestions[suggestions.length-1];highlight.call(this.current)}else{highlight.call(this.current);this.current=this.current.previousElementSibling;highlight.call(this.current)}}
if(k.keyCode===13){this.value=this.current.textContent;document.getElementById("dropdown-content").innerHTML=""}};for(var i=0;i<suggestions.length;i++){suggestions[i].addEventListener("mouseenter",function(){searchField.current.classList.toggle("suggested-coin-actv");searchField.current=this;highlight.call(this)});suggestions[i].addEventListener("click",function(){searchField.value=this.textContent;document.getElementById("dropdown-content").innerHTML=""})}}}
function highlight(){this.classList.toggle("suggested-coin-actv")}})();(function priceChecker(){var submit=document.querySelector("#getPrice");submit.addEventListener("click",function(){removeDisplay();document.getElementById("dropdown-content").innerHTML="";sessionStorage.clear();submit.value=searchField.value;lookupSymbol(submit);setInterval(function(){lookupSymbol(submit)},10000)});function lookupSymbol(inputVal){makeRequest("https://min-api.cryptocompare.com/data/all/coinlist",function(data){console.log("Start to search for matching symbol...");var coins=data.Data;var symbol;Object.keys(coins).forEach(function(key){if(inputVal.value.toUpperCase()===coins[key].CoinName.toUpperCase()){symbol=coins[key].Symbol;lookupPrice.call(symbol)}});if(!symbol){Object.keys(coins).forEach(function(key){if(inputVal.value.toUpperCase()===coins[key].Symbol.toUpperCase()){symbol=coins[key].Symbol;lookupPrice.call(symbol)}});if(!symbol){priceNotFound.call("There is no data for the "+inputVal.value.toUpperCase())}}})}
function lookupPrice(){let url="https://min-api.cryptocompare.com/data/price?fsym="+this+"&tsyms=BTC,ETH,USD";makeRequest(url,function(data){console.log("Symbol match found, start looking up prices...");let prices=data;priceFound.call(prices)})}
function priceFound(){let display=document.querySelector(".price");removeDisplay();let ul=document.createElement("ul");ul.className="price-list";display.appendChild(ul);Object.keys(this).forEach(function(key){let li=document.createElement("li");let text=document.createTextNode(key+": ");li.appendChild(text);let span=document.createElement("span");let price=document.createTextNode(this[key]);span.classList.add(key);span.appendChild(price);li.appendChild(span);ul.appendChild(li)},this);changeColor.call(this);sessionStorage.setItem("prevData",JSON.stringify(this))}
function priceNotFound(){console.log("No symbol match found...");var display=document.querySelector(".price");removeDisplay();var p=document.createElement("p");p.className="price-list";var mes=document.createTextNode(this);display.appendChild(p).appendChild(mes)}
function removeDisplay(){console.log("Removing prev display entry, if any");var display=document.querySelector(".price");var displayList=document.querySelector(".price-list");if(displayList){display.removeChild(displayList)}}
function changeColor(){let prevPrices=JSON.parse(sessionStorage.getItem("prevData"));if(prevPrices){Object.keys(this).forEach(function(key){let item=document.querySelector("."+key);if(prevPrices[key]<this[key]){item.style.color="green"}else if(prevPrices[key]>this[key]){item.style.color="red"}},this)}}})()}
  </script>
</html>
